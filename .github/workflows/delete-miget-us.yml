name: Delete miget-us package

on:
  workflow_dispatch:

jobs:
  delete-package:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read

    steps:
      - name: Delete all versions of miget-us
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const packageName = "miget-us";   // 就是 Packages 里显示的名字
            const packageType = "container";

            const versions = await github.paginate(
              github.rest.packages.getAllPackageVersionsForPackageOwnedByUser,
              {
                username: owner,
                package_type: packageType,
                package_name: packageName,
                per_page: 100,
              }
            );

            console.log(`Found ${versions.length} versions`);

            for (const v of versions) {
              console.log(`Deleting version ${v.id}`);
              await github.rest.packages.deletePackageVersionForUser({
                username: owner,
                package_type: packageType,
                package_name: packageName,
                package_version_id: v.id,
              });
            }